/*
* Curtain.js - Create an unique page transitioning system
* ---
* Version: 2
* Copyright 2011, Victor Coulon (http://victorcoulon.fr)
* Released under the MIT Licence
*/(function(e,t,n,r){function o(t,n){var r=this;this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=i;this._ignoreHashChange=!1;this.init()}var i="curtain",s={scrollSpeed:300,bodyHeight:0,linksArray:[],mobile:!1,scrollButtons:{},controls:null,curtainLinks:".curtain-links",enableKeys:!0,easing:"swing",disabled:!1,nextSlide:function(){},prevSlide:function(){}};o.prototype={init:function(r){var i=this;this.$element=e(this.element);this.$li=e(this.element).find(">li");this.$liLength=this.$li.length;i.$windowHeight=e(t).height();i.$elDatas={};i.$document=e(n);i.$window=e(t);i.webkit=navigator.userAgent.indexOf("Chrome")>-1||navigator.userAgent.indexOf("Safari")>-1;e.Android=navigator.userAgent.match(/Android/i);e.iPhone=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i);e.iPad=navigator.userAgent.match(/iPad/i);e.iOs4=/OS [1-4]_[0-9_]+ like Mac OS X/i.test(navigator.userAgent);if(e.iPhone||e.iPad||e.Android||i.options.disabled){this.options.mobile=!0;this.$li.css({position:"relative"});this.$element.find(".fixed").css({position:"absolute"})}this.options.mobile?this.scrollEl=this.$element:e.browser.mozilla||e.browser.msie?this.scrollEl=e("html"):this.scrollEl=e("body");if(i.options.controls){i.options.scrollButtons.up=e(i.options.controls).find('[href="#up"]');i.options.scrollButtons.down=e(i.options.controls).find('[href="#down"]');if(!e.iOs4&&(e.iPhone||e.iPad)){i.$element.css({position:"fixed",top:0,left:0,right:0,bottom:0,"-webkit-overflow-scrolling":"touch",overflow:"auto"});e(i.options.controls).css({position:"absolute"})}}var s=function(){i.setDimensions();i.$li.eq(0).addClass("current");i.setCache();i.options.mobile||i.$li.eq(1).length&&i.$li.eq(1).nextAll().addClass("hidden");i.setEvents();i.setLinks();r||i.isHashIsOnList(location.hash.substring(1))};i.$element.find("img").length?i.imageLoaded(s):s()},scrollToPosition:function(t){var n=null,i=this;if(i.scrollEl.is(":animated"))return!1;if(t==="up"||t=="down"){var s=t==="up"?i.$current.prev():i.$current.next();if(i.$step){i.$current.find(".current-step").length||i.$step.eq(0).addClass("current-step");var o=t==="up"?i.$current.find(".current-step").prev(".step"):i.$current.find(".current-step").next(".step");o.length&&(n=i.options.mobile?o.position().top+i.$elDatas[i.$current.index()]["data-position"]:o.position().top+i.$elDatas[i.$current.index()]["data-position"])}n=n||(i.$elDatas[s.index()]===r?null:i.$elDatas[s.index()]["data-position"]);n!==null&&i.scrollEl.animate({scrollTop:n},i.options.scrollSpeed,i.options.easing)}else if(t==="top")i.scrollEl.animate({scrollTop:0},i.options.scrollSpeed,i.options.easing);else if(t==="bottom")i.scrollEl.animate({scrollTop:i.options.bodyHeight},i.options.scrollSpeed,i.options.easing);else{var u=e("#"+t).index(),a=Math.abs(i.currentIndex-u)*this.options.scrollSpeed*4/i.$liLength;i.scrollEl.animate({scrollTop:i.$elDatas[u]["data-position"]||null},a<=i.options.scrollSpeed?i.options.scrollSpeed:a,this.options.easing)}},scrollEvent:function(){var t=this,n=t.$document.scrollTop();if(n<t.currentP&&t.currentIndex==1)return;if(n<t.currentP+t.currentHeight){t.webkit?t.$current.css({"-webkit-transform":"translateY("+ -(n-t.currentP)+"px) translateZ(0)"}):t.$current.css({marginTop:-(n-t.currentP)});if(t.$fixedLength){var r=parseInt(t.$fixed.attr("data-top"),10);n+t.$windowHeight>=t.currentP+t.currentHeight?t.$fixed.css({position:"fixed"}):t.$fixed.css({position:"absolute",marginTop:Math.abs(n-t.currentP)})}t.$stepLength&&e.each(t.$step,function(r,i){if(e(i).position().top+t.currentP<=n+5&&e(i).position().top+t.currentP+e(i).height()>=n+5&&!e(i).hasClass("current-step")){t.$step.removeClass("current-step");e(i).addClass("current-step");return!1}});t.parallaxBg&&t.$current.css({"background-position-y":n*t.parallaxBg});t.$fade.length&&t.$fade.css({opacity:1-n/t.$fade.attr("data-fade")});t.$slowScroll.length&&t.$slowScroll.css({"margin-top":n/t.$slowScroll.attr("data-slow-scroll")})}else{t._ignoreHashChange=!0;t.$current.next().attr("id")&&t.setHash(t.$current.next().attr("id"));t.$current.removeClass("current").addClass("hidden").next("li").addClass("current").next("li").removeClass("hidden");t.setCache();t.options.nextSlide(t)}},scrollMobileEvent:function(){var t=this,n=t.$element.scrollTop();if(n+10<t.currentP&&t.currentIndex>0){t._ignoreHashChange=!0;t.$current.prev().attr("id")&&t.setHash(t.$current.prev().attr("id"));t.$current.removeClass("current").prev().addClass("current");t.setCache();t.options.prevSlide()}else if(n+10<t.currentP+t.currentHeight)t.$stepLength&&e.each(t.$step,function(r,i){if(e(i).position().top+t.currentP<=n&&e(i).position().top+t.currentP+e(i).outerHeight()>=n&&!e(i).hasClass("current-step")){t.$step.removeClass("current-step");e(i).addClass("current-step")}});else{t._ignoreHashChange=!0;t.$current.next().attr("id")&&t.setHash(t.$current.next().attr("id"));t.$current.removeClass("current").next().addClass("current");t.setCache();t.options.nextSlide()}},setDimensions:function(){var t=this,n=0,r=!1,i=null;t.$windowHeight=t.$window.height();this.$li.each(function(s){var o=e(this);r=o.hasClass("cover");if(r){o.css({height:t.$windowHeight,zIndex:999-s}).attr("data-height",t.$windowHeight).attr("data-position",n);t.$elDatas[o.index()]={"data-height":parseInt(t.$windowHeight,10),"data-position":parseInt(n,10)};n+=t.$windowHeight}else{i=o.outerHeight()<=t.$windowHeight?t.$windowHeight:o.outerHeight();o.css({minHeight:i,zIndex:999-s}).attr("data-height",i).attr("data-position",n);t.$elDatas[o.index()]={"data-height":parseInt(i,10),"data-position":parseInt(n,10)};n+=i}if(o.find(".fixed").length){var u=o.find(".fixed").css("top");o.find(".fixed").attr("data-top",u)}});this.options.mobile||this.setBodyHeight()},setEvents:function(){var n=this;e(t).on("resize",function(){n.setDimensions()});n.options.mobile?n.$element.on("scroll",function(){n.scrollMobileEvent()}):n.$window.on("scroll",function(){n.scrollEvent()});n.options.enableKeys&&n.$document.on("keydown",function(e){if(e.keyCode===38||e.keyCode===37){n.scrollToPosition("up");e.preventDefault();return!1}if(e.keyCode===40||e.keyCode===39){n.scrollToPosition("down");e.preventDefault();return!1}if(e.keyCode===36){n.scrollToPosition("top");e.preventDefault();return!1}if(e.keyCode===35){n.scrollToPosition("bottom");e.preventDefault();return!1}});if(n.options.scrollButtons){n.options.scrollButtons.up&&n.options.scrollButtons.up.on("click",function(e){e.preventDefault();n.scrollToPosition("up")});n.options.scrollButtons.down&&n.options.scrollButtons.down.on("click",function(e){e.preventDefault();n.scrollToPosition("down")})}n.options.curtainLinks&&e(n.options.curtainLinks).on("click",function(t){t.preventDefault();var r=e(this).attr("href");if(!n.isHashIsOnList(r.substring(1))&&i)return!1;var i=n.$elDatas[e(r).index()]["data-position"]||null;i&&n.scrollEl.animate({scrollTop:i},n.options.scrollSpeed,n.options.easing);return!1});n.$window.on("hashchange",function(e){n._ignoreHashChange===!1&&n.isHashIsOnList(location.hash.substring(1));n._ignoreHashChange=!1})},setBodyHeight:function(){var t=0;for(var n in this.$elDatas){var r=this.$elDatas[n];t+=r["data-height"]}this.options.bodyHeight=t;e("body").height(t)},setLinks:function(){var t=this;this.$li.each(function(){var n=e(this).attr("id")||0;t.options.linksArray.push(n)})},setHash:function(t){el=e("[href=#"+t+"]");el.parent().siblings("li").removeClass("active");el.parent().addClass("active");history.pushState?history.pushState(null,null,"#"+t):location.hash=t},setCache:function(){var e=this;e.$current=e.$element.find(".current");e.$fixed=e.$current.find(".fixed");e.$fixedLength=e.$fixed.length;e.$step=e.$current.find(".step");e.$stepLength=e.$step.length;e.currentIndex=e.$current.index();e.currentP=e.$elDatas[e.currentIndex]["data-position"];e.currentHeight=e.$elDatas[e.currentIndex]["data-height"];e.parallaxBg=e.$current.attr("data-parallax-background");e.$fade=e.$current.find("[data-fade]");e.$slowScroll=e.$current.find("[data-slow-scroll]")},isHashIsOnList:function(t){var n=this;e.each(n.options.linksArray,function(e,r){if(r===t){n.scrollToPosition(t);return!1}})},readyElement:function(e,t){var n=setInterval(function(){if(e.length){t(e.length);clearInterval(n)}},60)},imageLoaded:function(t){var n=this,i=n.$element.find("img"),s=i.length,o="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";i.bind("load.imgloaded",function(){if(--s<=0&&this.src!==o||e(this).not(":visible")){i.unbind("load.imgloaded");t.call(i,this)}}).each(function(){if(this.complete||this.complete===r){var e=this.src;this.src=o;this.src=e}})}};e.fn[i]=function(t){return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new o(this,t))})}})(jQuery,window,document);